# 字节对齐

## 基本概念

- 不同类型 对应的偏移量的倍数

| Type   | Offset  |
| :-----: | ------: |
| char   | 1       |
| short  | 2       |
| int    | 4       |
| double | 8       |

---

``` c++
struct Data {
    double ddal;
    char dda;
    int type;
};
```
分配空间: 8 + 1 + _(3)_ + 4 = 16

中间的 _(3)_ 是用来对齐，使得 int 型的偏移量是 4 的倍数

---

``` c++
struct Data {
    char dda;
    double ddal;
    int type;
};
```
分配空间：1 + _(7)_ + 8 + 4 + _(4)_ = 24

中间的 _(7)_ 是用来对齐，使得 double 型的偏移脸是 8 的倍数

如果不加最后一个 _(4)_，整个结构体的大小是 20 个字节，不是结构体中最大空间的类型所占用的字节数（double 类型 8）的倍数，所以需要填充，达到 24 个字节。

---

## VC 中自行设定

``` c++
#pragma pack(push)
#pragma pack(4)
struct Data {
    char m1;
    double m4;
    int m3;
};
#pragma pack(pop)
```

分配空间：1 + _(3)_ + 8 + 4 = 16

只需要满足 4 字节对齐即可，因为我们已经自行指定了。

如果 n 大于变量所占字节数，那么该变量按照默认的对齐方式即可。

对于结构体的总大小，如果 n 大于所有成员变量类型所需占用的字节数，那么结构的总大小必须为占用空间最大的变量的空间数的倍数，否则为 n 的倍数。

- 也就是说，对齐按照指定 **n** 和 **默认值** 二者中的较小值进行
- 对于成员变量还是一个结构体来说，它的默认对齐方式就是它的所有成员使用的对齐参数中最大的一个

*** 

** 注： **union 变量**所占用的内存长度等于最长的成员的内存长度
